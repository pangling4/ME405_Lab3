<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 405: Lab 3: Multitasking: On Schedule</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ME 405: Lab 3
   </div>
   <div id="projectbrief">Multitasking</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Multitasking: On Schedule </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_src_readme"></a>This exercise involved utilizing our motor driver, encoder driver, and closed loop controller. This involved creating seperate tasks for these, and assigning appropriate priorities and periods (sampling rates) for each task. This involved utilizing the files <a class="el" href="cotask_8py.html" title="This file contains classes to run cooperatively scheduled tasks in a multitasking system.">cotask.py</a>, <a class="el" href="task__share_8py.html" title="This file contains classes which allow tasks to share data without the risk of data corruption by int...">task_share.py</a>, and <a class="el" href="basic__tasks_8py.html" title="This file contains a demonstration program that runs some tasks, an inter-task shared variable,...">basic_tasks.py</a> from the ME405 support repository towards implementing our multitasking regime. <a class="el" href="basic__tasks_8py.html" title="This file contains a demonstration program that runs some tasks, an inter-task shared variable,...">basic_tasks.py</a> served as a template towards creating our <a class="el" href="main_8py.html" title="This file contains tasks to simultaneously perform closed loop control on two Pittman motors in ME 40...">main.py</a> in terms of implementing the tasks and sending data over serial. It is necessary to perform multitasking in order to control the position of more than one motor. A real-time scheduler is necessary in order to control the position of multiple motors with their corresponding encoders and closed-loop controllers. The period of the motor and encoder tasks were set to 10 ms, however the motor had a priority of 1, and the encoder had a priority of 2. The controller period is set by the user, and the step response results are shown below in Figures 1-5.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Cotask.py</h2>
<p ><a class="el" href="cotask_8py.html" title="This file contains classes to run cooperatively scheduled tasks in a multitasking system.">Cotask.py</a> contains two necessary classes which are instrumental towards task management. One class is called Task. This class initializes a user created task by assigning the name, priority, period, profile, and trace. There are several methods which we used in particular. The .schedule() method sees if the task is ready to run and if so, works through the profile and trace methods. If not, it goes to the next text the .get_trace() method uses the trace parameter within the initialization to determine the time and states from which the system transitions. The other class is called the TaskList. This task holds the list of tasks that is run by the task scheduler and appends these to a list based on priority. pri_sched() runs these tasks according to priorities.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
task_share.py</h2>
<p >This contains the classes which allow the tasks to share data so that it does not get corrupted due to interrupts. The central class is BaseShare which works with queues and shares that work between tasks. The Queue class is used to arrange a queue of data to share between tasks. The put() method puts an item in the queue and if the queue is full, it waits until there is room before filling the queue more. The queue is buffered. Queues are useful for sending byte arrays. The data from the queue is processed in a First In First Out method (FIFO), where the oldest (first) entry is processed first. The get() method reads the item from the queue. There is a num_in() method to check how many items are in the queue. The Share class is more conditioned for an item by item basis rather than a byte array. It also has the put() and get() methods just like the Queues class.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Multitask Implementation Results</h1>
<p >Our results here were using the flywheel within our multitasking regime. This shows the effect of different user defined periods for the motor controller on the step response. This is a test, are images working. added jpeg <img src="Per_10.jpeg" alt="" class="inline" title="Flywheel Step Response!"/></p>
<p ><em>Figure 1: Step response with a controller period of 10 ms.</em></p>
<p >The fast sampling rate yields an excellent plot with a minimal steady state error.</p>
<p ><img src="Per_75.png" alt="" class="inline" title="Flywheel Step Response!"/></p>
<p ><em>Figure 2: Step response with a controller period of 75 ms.</em></p>
<p >The larger controller period still yields decent results with small overshoot. This is an acceptable run rate for the motor control task. It should be slightly faster than the slowest rate.</p>
<p ><img src="Per_90.png" alt="" class="inline" title="Flywheel Step Response!"/></p>
<p ><em>Figure 3: Step response with a controller period of 90 ms.</em></p>
<p >The overshoot becomes less continuous then smaller periods, this is less than ideal for a run rate.</p>
<p ><img src="Per_100.png" alt="" class="inline" title="Flywheel Step Response!"/></p>
<p ><em>Figure 4: Step response with a controller period of 100 ms.</em></p>
<p >The overshoot is larger than in previous periods. This is not useful.</p>
<p ><img src="Per_200.png" alt="" class="inline" title="Flywheel Step Response!"/></p>
<p ><em>Figure 5: Step response with a controller period of 200 ms.</em></p>
<p >There is significant overshoot, with two peaks by running the controller this slow. This is unacceptable, and is too slow for motor control implementations.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Adding a second motor</h1>
<p >This section is to be completed in the near future. We ran into difficulties within our queues and shares when attempting to run tasks for an additional motor, encoder, and controller. When running two motors, we expect that the tasks will need to be run at faster periods in order to yield acceptable results. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
